{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "descriptionStep",
        "type": "Microsoft.Common.Section",
        "label": "Description",
        "elements": [
          {
            "name": "description",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This deployment will onboard customers to Azure Lighthouse and deploy specific Azure policies."
            }
          }
        ]
      }
    ],
    "steps": [
      {
        "name": "lighthouseOnboarding",
        "label": "Lighthouse Onboarding",
        "elements": [
          {
            "name": "deployLighthouse",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Lighthouse Onboarding",
            "defaultValue": false
          }
        ]
      },
      {
        "name": "deployPolicies",
        "label": "Deploy Policies",
        "elements": [
          {
            "name": "deployPoliciesCheckbox",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy Policies",
            "defaultValue": false
          },
          {
            "name": "allowedLocations",
            "type": "Microsoft.Common.MultiSelectDropdown",
            "label": "Allowed Locations",
            "tooltip": "Select the allowed locations for resources.",
            "constraints": {
              "required": true,
              "allowedValues": "[map(steps('deployPolicies').computeApi.value, 'displayName')]"
            },
            "visible": "[steps('deployPolicies').deployPoliciesCheckbox]"
          },
          {
            "name": "computeApi",
            "type": "Microsoft.Solutions.ArmApiControl",
            "request": {
              "method": "GET",
              "path": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Compute/locations?api-version=2021-04-01')]"
            }
          },
          {
            "name": "allowedVmSizes",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "Allowed VM Sizes",
            "tooltip": "Select the allowed VM sizes for virtual machines.",
            "recommendedSizes": [
              "Standard_B2as_v2",
              "Standard_D8as_v5",
              "Standard_D8ads_v5",
              "Standard_NV6ads_A10_v5"
            ],
            "osPlatform": "Windows",
            "constraints": {
              "required": true
            },
            "visible": "[steps('deployPolicies').deployPoliciesCheckbox]"
          }
        ]
      }
    ],
    "outputs": {
      "allowedLocations": "[steps('deployPolicies').allowedLocations]",
      "allowedVmSizes": "[steps('deployPolicies').allowedVmSizes]"
    }
  }
}
